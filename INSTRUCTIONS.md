# Полное руководство по Gemini CLI

Это руководство представляет собой всеобъемлющую инструкцию по установке, использованию и разработке Gemini CLI. Здесь собрана вся необходимая информация из документации проекта, чтобы служить единым источником знаний как для новых, так и для опытных пользователей.

## Оглавление

1.  [Введение](#1-введение)
2.  [Быстрый старт](#2-быстрый-старт)
3.  [Аутентификация](#3-аутентификация)
4.  [Основы использования](#4-основы-использования)
5.  [Команды CLI](#5-команды-cli)
6.  [Конфигурация](#6-конфигурация)
7.  [Контекст и Память](#7-контекст-и-память)
8.  [Инструменты](#8-инструменты)
9.  [Расширенные возможности](#9-расширенные-возможности)
10. [Для разработчиков](#10-для-разработчиков)
11. [Устранение неполадок](#11-устранение-неполадок)
12. [Удаление](#12-удаление)
13. [Квоты, Цены и Условия использования](#13-квоты-цены-и-условия-использования)

---

## 1. Введение

**Gemini CLI** — это мощный инструмент командной строки для рабочих процессов с использованием ИИ, который подключается к вашим инструментам, понимает ваш код и ускоряет вашу работу. Он предоставляет интерактивную среду (REPL) для взаимодействия с моделями Gemini прямо из вашего терминала.

### Пример сценария использования
Представьте, что вы работаете над новым проектом и хотите быстро понять его структуру.

```bash
# Запускаем Gemini в директории проекта
gemini

# Задаем вопрос
> Проанализируй этот проект и опиши его основную архитектуру. Какие файлы являются ключевыми?
```
Gemini CLI, используя свои инструменты для чтения файлов, проанализирует код и предоставит вам структурированный ответ, экономя ваше время.

### Архитектура

Gemini CLI состоит из двух основных пакетов:

1.  **CLI (`packages/cli`):** Пользовательский интерфейс, который обрабатывает ввод, отображает вывод и управляет взаимодействием с пользователем.
2.  **Core (`packages/core`):** Бэкенд, который взаимодействует с Gemini API, управляет инструментами и обрабатывает запросы от CLI.

Типичный поток взаимодействия выглядит так: пользователь вводит запрос -> CLI отправляет его в Core -> Core отправляет его в Gemini API -> API отвечает текстом или запросом на использование инструмента -> Core выполняет инструмент (при необходимости с подтверждением пользователя) -> результат инструмента отправляется обратно в API -> API генерирует финальный ответ -> Core отправляет его в CLI -> CLI отображает ответ пользователю.

---

## 2. Быстрый старт

### Системные требования

*   **Node.js:** версия 18 или выше.
*   **Git:** для клонирования репозитория и использования git-зависимых функций.

### Установка

Вы можете запустить CLI без установки или установить его глобально.

**Вариант 1: Запуск через `npx` (без установки)**

Это самый быстрый способ начать работу. Выполните в терминале:

```bash
npx https://github.com/google-gemini/gemini-cli
```

**Вариант 2: Глобальная установка через `npm`**

```bash
npm install -g @google/gemini-cli
gemini
```

### Первый запуск

При первом запуске вам будет предложено:

1.  **Выбрать цветовую тему.**
2.  **Пройти аутентификацию.** Войдите в систему с помощью вашей учетной записи Google. Это предоставит вам бесплатный доступ к Gemini с определенными лимитами.

После этого вы готовы к работе!

---

## 3. Аутентификация

Gemini CLI требует аутентификации для доступа к сервисам Google AI. Существует несколько методов:

**1. Вход через Google (Gemini Code Assist)**

*   **Как работает:** При первом запуске CLI перенаправит вас на веб-страницу для входа через вашу учетную запись Google. Учетные данные кэшируются локально для последующих запусков.
*   **Требования:** Может потребоваться указать `GOOGLE_CLOUD_PROJECT`, если у вас аккаунт Google Workspace, вы участвуете в Google Developer Program или используете продукт за пределами поддерживаемых регионов.

**2. Ключ Gemini API**

*   **Как работает:** Вы получаете ключ API из [Google AI Studio](https://aistudio.google.com/app/apikey) и устанавливаете его как переменную окружения.
*   **Пример настройки:**
    ```bash
    export GEMINI_API_KEY="a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"
    ```
    Для постоянного использования добавьте эту строку в конфигурационный файл вашей оболочки (`~/.bashrc`, `~/.zshrc`) или в файл `.env`.

**3. Vertex AI**

*   **Требования:** Настроенный проект Google Cloud с включенным Vertex AI API и установленными учетными данными (Application Default Credentials).
*   **Пример настройки:**
    ```bash
    # Установка учетных данных
    gcloud auth application-default login

    # Установка переменных окружения
    export GOOGLE_CLOUD_PROJECT="my-gcp-project-12345"
    export GOOGLE_CLOUD_LOCATION="us-central1"
    export GOOGLE_GENAI_USE_VERTEXAI=true
    ```

### Сохранение переменных окружения в `.env` файлах

Вы можете создать файл `.gemini/.env` в корне вашего проекта или в домашней директории (`~/.gemini/.env`), чтобы хранить переменные окружения. CLI автоматически загрузит их при старте.

**Пример файла `.gemini/.env`:**
```
# .gemini/.env
GEMINI_API_KEY="a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6q7r8s9t0"
GOOGLE_CLOUD_PROJECT="my-gcp-project-12345"
```

---

## 4. Основы использования

### Интерактивный режим

Просто запустите `gemini` в вашем терминале, чтобы войти в интерактивный режим (REPL). Вы можете вводить запросы и получать ответы в реальном времени.

**Пример:**
```sh
# Перейдите в директорию существующего проекта
cd my-react-app
gemini

# Задаем вопрос
> Опиши архитектуру этой системы. Какие основные компоненты и как они связаны?
```

### Неинтерактивный режим

Этот режим полезен для скриптов и автоматизации. Вы можете передать запрос через `pipe` или использовать флаг `-p`.

**Пример с `pipe`:**
```bash
echo "Напиши простой Python скрипт для вывода 'Hello, World!'" | gemini
```

**Пример с флагом `-p`:**
```bash
gemini -p "Какая команда git используется для просмотра истории коммитов?"
```

---

## 5. Команды CLI

Команды начинаются с префиксов `/`, `@` или `!`.

### Слэш-команды (`/`)

*   `/help` или `/?`: Показать справку.
*   `/bug`: Создать отчет об ошибке.
    *   **Пример:** `/bug Проблема с рендерингом таблиц`
*   `/chat save <tag>`, `/chat resume <tag>`, `/chat list`: Сохранить, возобновить или показать список сохраненных сессий чата.
    *   **Пример:** `/chat save feature-x`
*   `/clear` (Ctrl+L): Очистить экран терминала.
*   `/compress`: Сжать историю чата в краткое резюме для экономии токенов.
*   `/editor`: Открыть диалог выбора редактора.
*   `/mcp [desc|nodesc|schema]`: Показать информацию о подключенных MCP-серверах и их инструментах.
*   `/memory [show|refresh|add]`: Управлять иерархической памятью из файлов `GEMINI.md`.
    *   **Пример:** `/memory add Всегда используй JSDoc для функций.`
*   `/restore [id]`: Восстановить состояние проекта из контрольной точки.
    *   **Пример:** `/restore 2025-07-07T10-00-00_000Z-my-file.txt-write_file`
*   `/stats`: Показать статистику по текущей сессии (использование токенов и т.д.).
*   `/theme`: Открыть диалог смены темы оформления.
*   `/auth`: Открыть диалог смены метода аутентификации.
*   `/about`: Показать информацию о версии.
*   `/tools [desc|nodesc]`: Показать список доступных инструментов.
*   `/quit` или `/exit`: Выйти из CLI.

### At-команды (`@`)

Используются для включения содержимого файлов или директорий в ваш запрос.

*   `@<путь_к_файлу_или_папке>`: Вставляет содержимое указанного пути в запрос.
    *   **Пример:** `Проверь код на наличие ошибок в @src/components/Button.tsx`
    *   **Пример:** `Создай тесты для всех функций в директории @src/utils/`
    *   По умолчанию файлы, указанные в `.gitignore`, игнорируются.

### Shell-команды (`!`)

*   `!<команда>`: Выполняет указанную shell-команду и возвращается в CLI.
    *   **Пример:** `!git status`
*   `!`: Переключает в "режим оболочки", где все вводимые команды выполняются напрямую в shell. Повторный ввод `!` возвращает в обычный режим.

---

## 6. Конфигурация

Поведение CLI настраивается через несколько уровней, где каждый следующий уровень переопределяет предыдущий:

1.  **Значения по умолчанию**
2.  **Пользовательский файл настроек** (`~/.gemini/settings.json`)
3.  **Проектный файл настроек** (`<корень_проекта>/.gemini/settings.json`)
4.  **Переменные окружения** (включая файлы `.env`)
5.  **Аргументы командной строки**

### Файл `settings.json`

Это основной способ постоянной конфигурации.

**Пример `settings.json`:**
```json
{
  "theme": "Dracula",
  "sandbox": "docker",
  "coreTools": [
    "ReadFileTool",
    "GlobTool",
    "ShellTool(git)",
    "ShellTool(npm)"
  ],
  "excludeTools": [
    "ShellTool(rm)"
  ],
  "autoAccept": true
}
```

### Переменные окружения

**Пример использования:**
```bash
export GEMINI_MODEL="gemini-1.5-flash"
export DEBUG=true
gemini
```

### Аргументы командной строки

**Пример использования:**
```bash
gemini --model gemini-1.5-pro-latest --sandbox -p "Напиши Dockerfile для простого Node.js приложения"
```

---

## 7. Контекст и Память

### Иерархическая память (`GEMINI.md`)

Это мощная функция, позволяющая предоставлять модели специфичные для проекта инструкции, руководства по стилю кода и другую фоновую информацию.

**Пример файла `GEMINI.md` в корне проекта:**
```markdown
# Руководство по проекту "MyWebApp"

## Общие инструкции
- Весь код должен быть на TypeScript.
- Используй 2 пробела для отступов.
- Всегда добавляй JSDoc комментарии к новым функциям.

## Зависимости
- Не добавляй новые зависимости без обсуждения.
- Предпочитай `axios` для HTTP-запросов.
```

### Импорт в `GEMINI.md`

Вы можете разбивать большие файлы `GEMINI.md` на модули.

**Пример:**
```markdown
# GEMINI.md
@./docs/style_guide.md
@./docs/api_conventions.md
```

### Инструмент `save_memory`

Этот инструмент позволяет модели сохранять факты между сессиями.

**Пример диалога:**
```
> Запомни, что я предпочитаю использовать `pnpm` вместо `npm`.
```
Модель вызовет: `save_memory(fact="Пользователь предпочитает использовать pnpm вместо npm.")`

---

## 8. Инструменты

Инструменты расширяют возможности модели, позволяя ей взаимодействовать с вашей локальной средой.

### Примеры использования инструментов

*   **Найти все файлы конфигурации в проекте:**
    ```
    > Найди все файлы с расширением .json в этом проекте.
    ```
    (Вызовет `glob(pattern="**/*.json")`)

*   **Прочитать и объяснить файл:**
    ```
    > Прочитай файл package.json и объясни его основные разделы.
    ```
    (Вызовет `read_file(path="./package.json")`)

*   **Создать новый файл:**
    ```
    > Создай файл `hello.js` с кодом, который выводит "Hello, World!".
    ```
    (Вызовет `write_file(file_path="./hello.js", content="console.log('Hello, World!');")`)

*   **Выполнить команду:**
    ```
    > Покажи мне текущий статус веток git.
    ```
    (Вызовет `run_shell_command(command="git status")`)

### Безопасность

Многие инструменты, особенно те, что изменяют файлы или выполняют команды, требуют вашего **подтверждения** перед выполнением. CLI покажет вам, что именно собирается сделать инструмент, и запросит разрешение.

---

## 9. Расширенные возможности

### Sandboxing (Изолированная среда)

Изолирует потенциально опасные операции от вашей основной системы.

**Пример:**
```bash
# Запустить команду в песочнице Docker
gemini --sandbox -p "Установи зависимости из package.json"
```

### Checkpointing (Контрольные точки)

Автоматически сохраняет снимок вашего проекта перед тем, как инструмент внесет изменения в файлы.

**Пример:**
```bash
# Включить контрольные точки при запуске
gemini --checkpointing

> ... (выполняется команда, изменяющая файл) ...

# Если результат не понравился, можно откатиться
> /restore
# (появится список точек для восстановления)
```

### MCP Серверы

Model Context Protocol (MCP) серверы позволяют расширять CLI кастомными инструментами.

**Пример настройки в `settings.json`:**
```json
{
  "mcpServers": {
    "github": {
      "command": "docker",
      "args": [
        "run", "-i", "--rm", "-e", "GITHUB_PERSONAL_ACCESS_TOKEN",
        "ghcr.io/github/github-mcp-server"
      ],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "${GITHUB_PAT}"
      }
    }
  }
}
```
После этого можно давать команды вроде: `> Создай issue в репозитории 'user/repo' с заголовком 'Новая фича'`

### Расширения (Extensions)

Gemini CLI поддерживает расширения, которые могут добавлять конфигурацию.

**Пример структуры расширения:**
```
.gemini/
└── extensions/
    └── my-corp-tools/
        ├── gemini-extension.json
        └── GEMINI.md
```

### Телеметрия

Позволяет собирать данные о производительности для отладки.

**Пример запуска локального коллектора:**
```bash
# В одном терминале
npm run telemetry -- --target=local

# В другом терминале
gemini --telemetry
```

---

## 10. Для разработчиков

### Настройка окружения

1.  Установите Node.js 18+ и Git.
2.  Клонируйте репозиторий: `git clone https://github.com/google-gemini/gemini-cli.git`
3.  Перейдите в директорию: `cd gemini-cli`
4.  Установите зависимости: `npm install`

### Основные команды

*   **Сборка:** `npm run build`
*   **Запуск в режиме разработки:** `npm start`
*   **Тестирование (Unit):** `npm run test`
*   **Тестирование (Integration):** `npm run test:e2e`
*   **Линтинг и форматирование:** `npm run lint` и `npm run format`
*   **Полная проверка (preflight):** `npm run preflight`. **Обязательно запускайте перед созданием коммита!**

### Отладка

*   **VS Code:** Используйте конфигурацию "Attach" из `.vscode/launch.json` после запуска CLI в режиме отладки (`npm run debug`).
*   **React DevTools:** Запустите CLI с `DEV=true npm start` и подключитесь с помощью `npx react-devtools@4.28.5`.

### Соглашения по коду

*   Придерживайтесь существующего стиля кода.
*   Предпочитайте простые объекты с интерфейсами TypeScript вместо классов.
*   Используйте `import`/`export` для инкапсуляции.
*   Избегайте `any`, предпочитайте `unknown` с проверкой типов.
*   Активно используйте операторы для работы с массивами (`.map`, `.filter` и т.д.).

---

## 11. Устранение неполадок

*   **Ошибка `Failed to login. Message: Request contains an invalid argument`:** Вероятно, вы используете аккаунт Google Workspace. Попробуйте установить `GOOGLE_CLOUD_PROJECT` или использовать ключ API из AI Studio.
*   **Ошибка `EADDRINUSE` (Address already in use):** Другой процесс использует порт, который пытается занять MCP-сервер. Остановите этот процесс или измените порт.
*   **CLI не интерактивен в CI-окружении:** Если установлена переменная окружения, начинающаяся с `CI_`, CLI может запуститься в неинтерактивном режиме. Запустите его с `env -u <ИМЯ_ПЕРЕМЕННОЙ> gemini`.
*   **Не видите статистику по кэшированным токенам?** Кэширование токенов работает только при аутентификации через API-ключ, но не через OAuth (стандартный вход через Google).

---

## 12. Удаление

### Если вы использовали `npx`

`npx` кэширует пакеты. Чтобы удалить кэш:

*   **macOS / Linux:** `rm -rf "$(npm config get cache)/_npx"`
*   **Windows (CMD):** `rmdir /s /q "%LocalAppData%\npm-cache\_npx"`
*   **Windows (PowerShell):** `Remove-Item -Path (Join-Path $env:LocalAppData "npm-cache\_npx") -Recurse -Force`

### Если вы устанавливали глобально

```bash
npm uninstall -g @google/gemini-cli
```

---

## 13. Квоты, Цены и Условия использования

Квоты, цены и условия использования **зависят от вашего метода аутентификации**.

*   **Login with Google (бесплатный уровень):**
    *   **Квоты:** 60 запросов/минуту, 1000/день.
    *   **Цена:** Бесплатно.
    *   **Условия:** [Google Terms of Service](https://policies.google.com/terms?hl=en-US), [Gemini Code Assist Privacy Notice](https://developers.google.com/gemini-code-assist/resources/privacy-notice-gemini-code-assist-individuals). **Ваши данные могут использоваться для тренировки моделей.**
*   **Gemini API Key (бесплатный):**
    *   **Квоты:** Ограничены (например, 10 запросов/минуту).
    *   **Цена:** Бесплатно.
    *   **Условия:** [Gemini API Terms of Service](https://ai.google.dev/gemini-api/terms). **Ваши данные могут использоваться для тренировки моделей.**
*   **Gemini API Key (платный), Workspace, Vertex AI:**
    *   **Квоты и цены:** Зависят от вашего тарифного плана.
    *   **Условия:** [Google Cloud Platform Terms of Service](https://cloud.google.com/terms). **Ваши данные конфиденциальны и не используются для тренировки моделей.**

Вы можете отказаться от сбора анонимной статистики использования, установив `"usageStatisticsEnabled": false` в `settings.json`.