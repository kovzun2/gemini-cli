# Полное руководство по Gemini CLI

Это руководство представляет собой всеобъемлющую инструкцию по установке, использованию и разработке Gemini CLI. Здесь собрана и подробно раскрыта вся необходимая информация из документации проекта, чтобы служить единым источником знаний как для новых, так и для опытных пользователей.

## Оглавление

- [Полное руководство по Gemini CLI](#полное-руководство-по-gemini-cli)
  - [Оглавление](#оглавление)
  - [1. Введение](#1-введение)
    - [Что такое Gemini CLI?](#что-такое-gemini-cli)
    - [Основные возможности](#основные-возможности)
    - [Обзор архитектуры](#обзор-архитектуры)
  - [2. Быстрый старт](#2-быстрый-старт)
    - [Системные требования](#системные-требования)
    - [Установка и запуск](#установка-и-запуск)
    - [Первый запуск](#первый-запуск)
  - [3. Аутентификация](#3-аутентификация)
    - [Методы аутентификации](#методы-аутентификации)
    - [Хранение учетных данных](#хранение-учетных-данных)
  - [4. Основы использования](#4-основы-использования)
    - [Интерактивный и неинтерактивный режимы](#интерактивный-и-неинтерактивный-режимы)
  - [5. Команды CLI](#5-команды-cli)
    - [Слэш-команды (`/`)](#слэш-команды-)
    - [At-команды (`@`)](#at-команды-)
    - [Shell-команды (`!`)](#shell-команды-)
  - [6. Конфигурация](#6-конфигурация)
    - [Уровни конфигурации](#уровни-конфигурации)
    - [Файл `settings.json`](#файл-settingsjson)
    - [Переменные окружения](#переменные-окружения)
    - [Аргументы командной строки](#аргументы-командной-строки)
  - [7. Контекст и Память](#7-контекст-и-память)
    - [Иерархическая память (`GEMINI.md`)](#иерархическая-память-geminimd)
    - [Импорт в `GEMINI.md`](#импорт-в-geminimd)
    - [Инструмент `save_memory`](#инструмент-save_memory)
  - [8. Инструменты (Tools)](#8-инструменты-tools)
    - [Обзор инструментов](#обзор-инструментов)
    - [Подробное описание встроенных инструментов](#подробное-описание-встроенных-инструментов)
  - [9. Расширенные возможности](#9-расширенные-возможности)
    - [Sandboxing (Изолированная среда)](#sandboxing-изолированная-среда)
    - [Checkpointing (Контрольные точки)](#checkpointing-контрольные-точки)
    - [MCP Серверы](#mcp-серверы)
    - [Расширения (Extensions)](#расширения-extensions)
    - [Телеметрия](#телеметрия)
  - [10. Для разработчиков](#10-для-разработчиков)
    - [Настройка окружения](#настройка-окружения)
    - [Процесс разработки и команды](#процесс-разработки-и-команды)
    - [Тестирование](#тестирование)
    - [Отладка](#отладка)
    - [Соглашения по коду](#соглашения-по-коду)
  - [11. Устранение неполадок](#11-устранение-неполадок)
  - [12. Удаление](#12-удаление)
  - [13. Квоты, Цены и Условия использования](#13-квоты-цены-и-условия-использования)

---

## 1. Введение

### Что такое Gemini CLI?

**Gemini CLI** — это мощный инструмент командной строки для рабочих процессов с использованием ИИ. Он предоставляет интерактивную среду (REPL) для взаимодействия с моделями Gemini прямо из вашего терминала, позволяя подключаться к вашим инструментам, понимать ваш код и ускорять рабочие процессы.

### Основные возможности

*   **Работа с кодом:** Запрашивайте и редактируйте большие кодовые базы, выходя за рамки стандартного контекстного окна модели.
*   **Мультимодальность:** Создавайте новые приложения из PDF-файлов, эскизов или изображений.
*   **Автоматизация:** Автоматизируйте рутинные задачи, такие как запросы к pull-реквестам или сложные rebase-операции в Git.
*   **Расширяемость:** Используйте инструменты и MCP-серверы для подключения новых возможностей, например, генерации медиа с помощью Imagen.
*   **Обоснованные ответы:** Интеграция с Google Search позволяет модели давать ответы, подкрепленные информацией из веба.

### Обзор архитектуры

Gemini CLI имеет модульную архитектуру, состоящую из двух основных пакетов и набора инструментов:

1.  **CLI (`packages/cli`):** Пользовательский интерфейс (frontend). Отвечает за обработку ввода, рендеринг вывода, управление историей и темами оформления.
2.  **Core (`packages/core`):** Бэкенд-сервер. Управляет взаимодействием с Gemini API, оркестрирует выполнение инструментов, управляет состоянием сессии и конфигурацией.
3.  **Инструменты (`packages/core/src/tools/`):** Модули, которые позволяют модели взаимодействовать с локальной средой (файловая система, shell, веб).

**Типичный поток взаимодействия:**
1.  Пользователь вводит запрос в CLI.
2.  CLI отправляет запрос в Core.
3.  Core формирует промпт (с историей и списком инструментов) и отправляет его в Gemini API.
4.  Gemini API отвечает сгенерированным текстом или запросом на вызов инструмента.
5.  Если запрошен инструмент, Core выполняет его (при необходимости запрашивая подтверждение у пользователя).
6.  Результат выполнения инструмента отправляется обратно в Gemini API.
7.  API генерирует финальный ответ на основе результата.
8.  Core передает ответ в CLI, который отображает его пользователю.

---

## 2. Быстрый старт

### Системные требования

*   **Node.js:** Версия 18 или выше.
*   **Git:** Необходим для клонирования репозитория и использования функций, связанных с Git.

### Установка и запуск

**Способ 1: `npx` (без постоянной установки)**
Самый быстрый способ начать. Выполняет последнюю версию прямо из репозитория GitHub.
```bash
npx https://github.com/google-gemini/gemini-cli
```

**Способ 2: Глобальная установка `npm`**
Устанавливает пакет на вашу систему для легкого доступа.
```bash
npm install -g @google/gemini-cli
gemini
```

### Первый запуск

При первом запуске CLI проведет вас через простую настройку:
1.  **Выбор цветовой темы:** Подберите наиболее комфортную для вас схему.
2.  **Аутентификация:** Войдите в свою учетную запись Google. Это предоставит вам доступ к бесплатному уровню использования Gemini.

---

## 3. Аутентификация

### Методы аутентификации

Gemini CLI поддерживает несколько способов аутентификации:

1.  **Вход через Google (Gemini Code Assist):**
    *   **Описание:** Стандартный метод, использующий ваш личный аккаунт Google. При первом запуске открывается браузер для входа.
    *   **Особенности:** Для пользователей Google Workspace или тех, кто находится за пределами поддерживаемых регионов, может потребоваться настройка `GOOGLE_CLOUD_PROJECT`.

2.  **Ключ Gemini API:**
    *   **Описание:** Использует API-ключ, полученный в [Google AI Studio](https://aistudio.google.com/app/apikey). Предоставляет бесплатный уровень с определенными лимитами и возможность перехода на платный план.
    *   **Настройка:**
        ```bash
        export GEMINI_API_KEY="ВАШ_API_КЛЮЧ"
        ```

3.  **Vertex AI:**
    *   **Описание:** Для пользователей Google Cloud. Требует настроенного проекта и учетных данных.
    *   **Настройка:**
        ```bash
        gcloud auth application-default login
        export GOOGLE_CLOUD_PROJECT="ВАШ_PROJECT_ID"
        export GOOGLE_CLOUD_LOCATION="ВАШ_РЕГИОН"
        export GOOGLE_GENAI_USE_VERTEXAI=true
        ```

### Хранение учетных данных

Для удобства вы можете хранить переменные окружения в файле `.env`. CLI ищет его в следующем порядке:
1.  `.gemini/.env` в текущей и родительских директориях.
2.  `.env` в текущей и родительских директориях.
3.  `~/.gemini/.env` в домашней директории.
4.  `~/.env` в домашней директории.

**Пример файла `.gemini/.env`:**
```
# Это комментарий
GEMINI_API_KEY="a1b2c3d4e5f6..."
GOOGLE_CLOUD_PROJECT="my-gcp-project-123"
```

---

## 4. Основы использования

### Интерактивный и неинтерактивный режимы

**Интерактивный режим (REPL)**
Запускается командой `gemini`. Позволяет вести диалог с моделью.

*Пример:*
```bash
cd my-project
gemini
> Рефактори этот код в @src/legacy.js, используя современные стандарты ES6.
```

**Неинтерактивный режим**
Идеален для скриптов и быстрой автоматизации.

*Пример с `pipe`:*
```bash
echo "Напиши функцию на JavaScript, которая суммирует два числа" | gemini
```

*Пример с флагом `-p` или `--prompt`:*
```bash
gemini -p "Как развернуть простое веб-приложение на Firebase?"
```

---

## 5. Команды CLI

### Слэш-команды (`/`)
Управляют сессией и интерфейсом.

*   `/help` или `/?`: Показать справку.
*   `/bug <описание>`: Создать отчет об ошибке.
*   `/chat save <tag>`, `/chat resume <tag>`, `/chat list`: Управление сессиями чата.
    *   **Сценарий:** Вы работаете над новой фичей (`feature-x`) и исследуете подходы. Внезапно появляется срочный баг (`bug-123`).
        1.  Сохраните текущий контекст: `/chat save feature-x-research`
        2.  Очистите экран и начните работать над багом: `/clear`, затем `> Проанализируй @src/payments.js, чтобы найти причину бага #123.`
        3.  После исправления бага вернитесь к работе над фичей. Сначала посмотрите список сохранений: `/chat list`.
        4.  Возобновите сессию: `/chat resume feature-x-research`. Ваш предыдущий диалог будет полностью восстановлен.
*   `/clear` (Ctrl+L): Очистить экран.
*   `/compress`: Сжать историю чата в краткое резюме.
    *   **Сценарий:** Ваш диалог стал очень длинным, и вы замечаете, что ответы модели становятся медленнее, так как на каждый запрос отправляется вся история. Вы хотите продолжить обсуждение, но с чистого листа, сохранив при этом суть.
        1.  Выполните команду: `/compress`
        2.  Gemini проанализирует весь диалог и заменит его на краткое резюме. Например: "Мы обсудили рефакторинг компонента корзины, рассмотрели использование Redux и остановились на подходе с Context API. Следующий шаг - написание тестов."
        3.  Теперь вы можете продолжать диалог, и в контекст будет отправляться только это короткое резюме, экономя токены.
*   `/stats`: Показать статистику по токенам и сессии.
*   `/theme`: Открыть диалог смены темы.
*   `/tools [desc|nodesc]`: Показать список доступных инструментов.
*   `/quit` или `/exit`: Выйти.

### At-команды (`@`)
Включают содержимое файлов/директорий в ваш запрос.

*   `@<путь>`: Вставляет содержимое в запрос.
    *   **Пример:** `Создай документацию для функции в файле @src/api.ts`
    *   **Пример:** `Проанализируй зависимости в @package.json и предложи оптимизации.`
*   По умолчанию файлы из `.gitignore` исключаются.

### Shell-команды (`!`)
Взаимодействие с системной оболочкой.

*   `!<команда>`: Выполнить shell-команду.
    *   **Пример:** `!npm install`
*   `!`: Переключить "режим оболочки" для прямого ввода команд.

---

## 6. Конфигурация

### Уровни конфигурации
Настройки применяются в порядке возрастания приоритета:
1.  Значения по умолчанию.
2.  Пользовательский `settings.json` (`~/.gemini/settings.json`).
3.  Проектный `settings.json` (`./.gemini/settings.json`).
4.  Переменные окружения (включая `.env` файлы).
5.  Аргументы командной строки.

### Файл `settings.json`
Основной файл для постоянной конфигурации.

**Ключевые параметры:**
*   `theme` (string): Название темы (см. `/theme`).
*   `sandbox` (boolean|string): Настройка песочницы (`true`, `"docker"`, `"podman"`).
*   `coreTools` (array): Белый список инструментов. Можно ограничивать команды: `"ShellTool(git)"`.
*   `excludeTools` (array): Черный список инструментов: `"ShellTool(rm)"`.
*   `mcpServers` (object): Конфигурация MCP-серверов.
*   `checkpointing` (object): Включение и настройка контрольных точек.
*   `telemetry` (object): Настройка сбора телеметрии.
*   `autoAccept` (boolean): Авто-подтверждение "безопасных" вызовов инструментов.

**Пример `settings.json`:**
```json
{
  "theme": "Dracula",
  "sandbox": "docker",
  "autoAccept": true,
  "checkpointing": { "enabled": true }
}
```

### Переменные окружения
*   `GEMINI_API_KEY`: Ключ API.
*   `GEMINI_MODEL`: Модель по умолчанию (напр., `gemini-1.5-flash`).
*   `DEBUG`: Включает режим отладки.

### Аргументы командной строки
Переопределяют все другие настройки для текущей сессии.
*   `--model <имя>`: Использовать указанную модель.
*   `--prompt <запрос>`: Неинтерактивный режим.
*   `--sandbox`: Включить песочницу.
*   `--checkpointing`: Включить контрольные точки.
*   `--yolo`: Автоматически подтверждать все вызовы инструментов (включает песочницу).

---

## 7. Контекст и Память

### Иерархическая память (`GEMINI.md`)
Файлы `GEMINI.md` предоставляют модели постоянный контекст и инструкции.

**Порядок загрузки:**
1.  **Глобальный:** `~/.gemini/GEMINI.md`
2.  **Проектный:** От корня проекта до текущей директории.
3.  **Локальный:** В поддиректориях.

**Пример `GEMINI.md` в корне проекта:**
```markdown
# Руководство по стилю для проекта "Omega"
- Используй TypeScript.
- Форматирование: Prettier с настройками по умолчанию.
- Комментарии: JSDoc для всех экспортируемых функций.
- Тесты: Используй Jest. Каждый PR должен содержать тесты.
```

### Импорт в `GEMINI.md`
Используйте `@<путь_к_файлу.md>` для модульности.

**Пример:**
```markdown
# Основной GEMINI.md
@./docs/style_guide.md
@./docs/api_conventions.md
```

### Инструмент `save_memory`
Позволяет модели сохранять факты между сессиями.

**Пример диалога:**
`> Запомни: мой любимый фреймворк - Svelte.`
Модель вызовет: `save_memory(fact="Любимый фреймворк пользователя - Svelte.")`

---

## 8. Инструменты (Tools)

### Обзор инструментов
Инструменты - это функции, которые модель может вызывать для взаимодействия с окружением.

### Подробное описание встроенных инструментов

*   **`list_directory`**: Показывает содержимое папки.
    *   `> Что находится в папке src?`
*   **`read_file`**: Читает файл (текст, изображения, PDF).
    *   `> Прочитай README.md и сделай краткое резюме.`
*   **`write_file`**: Записывает или перезаписывает файл.
    *   `> Создай файл .gitignore и добавь в него node_modules.`
*   **`glob`**: Находит файлы по шаблону.
    *   `> Найди все .css файлы в проекте.`
*   **`search_file_content`**: Ищет текст в файлах.
    *   `> Где в коде используется функция 'calculateTotal'?`
*   **`replace`**: Заменяет текст в файле.
    *   `> Замени во всех файлах http://api.dev на https://api.prod.`
*   **`run_shell_command`**: Выполняет команду в оболочке.
    *   `> Установи зависимости, выполнив npm install.`
*   **`web_fetch`**: Получает содержимое веб-страниц.
    *   `> Сравни содержание двух статей: [URL1] и [URL2].`
*   **`google_web_search`**: Выполняет поиск в Google.
    *   `> Какие последние новости о выходе Angular 20?`

---

## 9. Расширенные возможности

### Sandboxing (Изолированная среда)
Изолирует выполнение команд для безопасности.

*   **Методы:** `sandbox-exec` (macOS), `docker`, `podman`.
*   **Включение:** Флаг `--sandbox` или `"sandbox": true` в `settings.json`.

### Checkpointing (Контрольные точки)
Автоматически сохраняет состояние проекта перед изменениями.

*   **Включение:** Флаг `--checkpointing` или `"checkpointing": { "enabled": true }`.
*   **Использование:** `/restore` для отката.

### MCP Серверы
Позволяют подключать кастомные наборы инструментов.

*   **Настройка:** Через `mcpServers` в `settings.json`.
*   **Пример:** Подключение сервера для работы с GitHub для создания issues прямо из CLI.

### Расширения (Extensions)
Способ упаковать и распространять конфигурации, включая MCP-серверы и `GEMINI.md`.

*   **Расположение:** `~/.gemini/extensions/` и `./.gemini/extensions/`.

### Телеметрия
Сбор данных о производительности для отладки.

*   **Включение:** Флаг `--telemetry` или `"telemetry": { "enabled": true }`.
*   **Просмотр:** Запустите локальный коллектор (`npm run telemetry -- --target=local`) и откройте Jaeger UI.

---

## 10. Для разработчиков

### Настройка окружения
1.  `git clone https://github.com/google-gemini/gemini-cli.git`
2.  `cd gemini-cli`
3.  `npm install`

### Процесс разработки и команды
*   `npm run build`: Собрать проект.
*   `npm start`: Запустить в режиме разработки.
*   `npm run preflight`: **Обязательная** полная проверка перед коммитом.

### Тестирование
*   `npm run test`: Unit-тесты.
*   `npm run test:e2e`: Интеграционные тесты.

### Отладка
*   `npm run debug`: Запуск в режиме отладки для подключения из VS Code.
*   `DEV=true npm start`: Запуск для подключения React DevTools.

### Соглашения по коду
*   Придерживайтесь существующего стиля.
*   Предпочитайте простые объекты с интерфейсами TypeScript вместо классов.
*   Используйте `import`/`export` для инкапсуляции.
*   Избегайте `any`, используйте `unknown`.

---

## 11. Устранение неполадок
*   **Ошибка `Failed to login`:** Если у вас аккаунт Workspace, попробуйте установить `GOOGLE_CLOUD_PROJECT` или использовать API-ключ.
*   **Ошибка `EADDRINUSE`:** Порт занят. Остановите процесс, использующий порт.
*   **CLI не интерактивен:** Проверьте переменные окружения `CI_`.

---

## 12. Удаление
*   **`npx`:** Очистите кэш `npx`: `rm -rf "$(npm config get cache)/_npx"` (macOS/Linux).
*   **Глобальная установка:** `npm uninstall -g @google/gemini-cli`.

---

## 13. Квоты, Цены и Условия использования
Квоты, цены и политика конфиденциальности **напрямую зависят от вашего метода аутентификации**.

*   **Login with Google / Gemini API (бесплатный уровень):**
    *   **Данные:** Ваши промпты и код **могут использоваться** для улучшения продуктов Google, включая тренировку моделей.
*   **Gemini API (платный), Workspace, Vertex AI:**
    *   **Данные:** Ваши данные **конфиденциальны** и не используются для тренировки моделей.

Вы можете отключить сбор анонимной статистики использования (`"usageStatisticsEnabled": false` в `settings.json`), но это не меняет политику использования данных для тренировки моделей, которая определяется вашим типом аккаунта.
